---
layout: post
title: (Python) 파이썬과 Opencv를 이용한 컴퓨터 비전 학습 Chapter02
description: |
  Opencv3 computer vision with python cookbook
hide_image: true
tags:
  - programming
published: true
---

# (Python) 파이썬과 Opencv를 이용한 컴퓨터 비전 학습 Chapter02

(Python) 파이썬과 Opencv를 이용한 컴퓨터 비전 학습 Chapter02

# Chapter02.행렬,색상,필터
* * * 
행렬로 작업하는 방법에 대해 살펴본다. 픽셀 단위의 행렬을 사용해 수행하는 작업과 행렬 전체에 적용할 수 있는 연산 및 이미지 처리 절차에 대해 학습한다.

## 1. 행렬 조작: 생성하기, 채우기, 요소 접근하기, ROI

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np

image = np.full((480,640,3),255,np.uint8)

cv2.imshow('white',image)
cv2.waitKey()
cv2.destroyAllWindows()

image = np.full((480,640,3),(0,0,255),np.uint8)
cv2.imshow('red',image)
cv2.waitKey()
cv2.destroyAllWindows()

image.fill(0)
cv2.imshow('black',image)
cv2.waitKey()
cv2.destroyAllWindows()

image[240,160] =image[240,320] = image[240,48]=(255,255,255)
cv2.imshow('black with white pixels',image)
cv2.waitKey()
cv2.destroyAllWindows()

image[:,:,0] = 255
cv2.imshow('blue wiht white pixels',image)
cv2.waitKey()
cv2.destroyAllWindows()

image[:,320,:]=255
cv2.imshow('blue with white line', image)
cv2.waitKey()
cv2.destroyAllWindows()
```
![스크린샷, 2021-09-14 12-06-00](https://user-images.githubusercontent.com/69246778/133188371-859a4a7d-cc97-41c6-9995-098363bfc92c.png)
![스크린샷, 2021-09-14 12-07-00](https://user-images.githubusercontent.com/69246778/133188376-7d8f43f1-e852-4d4e-92be-81557f222404.png)
![스크린샷, 2021-09-14 12-07-10](https://user-images.githubusercontent.com/69246778/133188436-5d6cc2ee-e643-42b5-b991-4ed9b6946635.png)
![스크린샷, 2021-09-14 12-07-21](https://user-images.githubusercontent.com/69246778/133188471-84c99049-6186-4e8b-94ff-76de220349f1.png)
![s](https://user-images.githubusercontent.com/69246778/133188493-3cbcd497-a30b-488f-bf82-1f4dda735989.png)
![스크린샷, 2021-09-14 12-07-39](https://user-images.githubusercontent.com/69246778/133188502-f2b48e3f-cfd2-429f-a796-d99e2647b540.png)

                          
## 2. 데이터 타입과 스케일 변환
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np
image = cv2.imread('../data/Lena.png')
print('Shape:',image.shape)
print('Data type:', image.dtype)

cv2.imshow('image',image)
cv2.waitKey()
cv2.destroyAllWindows()


# 이미지를 부동소수점 데이터 타입으로 변환
image  = image.astype(np.float32)/255
print('Shape:',image.shape)
print('Data type:',image.dtype)


# 이미지의 요소를 2배로 스케일링하고 해당 값을 [0,1]범위로 조절
cv2.imshow('image', np.clip(image*2,0,1))
cv2.waitKey()
cv2.destroyAllWindows()

#이미지의 요소를 다시 [0,255]범위로 조절하고 요소 데이터 타입을 uint8로 변환
image = (image*255).astype(np.uint8)
print('Shape:',image.shape)
print('Datat type:', image.dtype)

cv2.imshow('image',image)
cv2.waitKey()
cv2.destroyAllWindows()
```

```
>>>
Shape: (512, 512, 3)
Data type: uint8
Shape: (512, 512, 3)
Data type: float32
Shape: (512, 512, 3)
Datat type: uint8
```

![스크린샷, 2021-09-14 12-11-47](https://user-images.githubusercontent.com/69246778/133188839-6997bc80-6dab-4baf-a052-7761f7e7190f.png)
![스크린샷, 2021-09-14 12-12-00](https://user-images.githubusercontent.com/69246778/133188845-ccea3bbe-b13d-442a-96ea-dd1699ac9a1a.png)
![스크린샷, 2021-09-14 12-12-12](https://user-images.githubusercontent.com/69246778/133188849-d0bbe7ce-1a90-41d1-b4e3-bf62a15ad2d0.png)

## 3. NumPy를 사용한 비이미지 데이터 영속성
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np

#임의의 값으로 초기화된 행렬을 생성하고 속성을 출력
mat=np.random.rand(100,100).astype(np.float32)
print('Shape:',mat.shape)
print('Data type:',mat.dtype)

#앞에서 생성한 행렬을 저장
np.savetxt('mat.csv',mat)

#저장한 파일을 다시 불러와 shape와 type출력
mat = np.loadtxt('mat.csv').astype(np.float32)
print('Shape:',mat.shape)
print('Data type:',mat.dtype)
```
```
>>>
Shape: (100, 100)
Data type: float32
Shape: (100, 100)
Data type: float32
```

## 4. 이미지 채널 조작
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np
image = cv2.imread('../data/Lena.png').astype(np.float32)/255
print('Shape:',image.shape)


#적색과 청색 채널을 서로 바꾼다
image[:,:,[0,2]]=image[:,:,[2,0]]
cv2.imshow('blue_and_red_swapped',image)
cv2.waitKey()
cv2.destroyAllWindows()


#원래대로 채널을 다시 바꾸고 이미지의 채색을 바꾸기 위해 다양한 스케일을 적용한다
image[:,:,[0,2]] = image[:,:,[2,0]]
image[:,:,0] = (image[:,:,0]*0.9).clip(0,1)
image[:,:,1] = (image[:,:,1]*1.1).clip(0,1)

cv2.imshow('image',image)
cv2.waitKey()
cv2.destroyAllWindows()
```
```
>>>
Shape: (512, 512, 3)
```

![스크린샷, 2021-09-14 12-17-28](https://user-images.githubusercontent.com/69246778/133189321-100e5f95-d620-491c-bc41-386b3067335d.png)
![스크린샷, 2021-09-14 12-17-35](https://user-images.githubusercontent.com/69246778/133189329-f14b0333-eeea-4ab2-ba53-8630197804a2.png)

## 5. 이미지의 색 공간 변환
[HSV](https://ko.wikipedia.org/wiki/HSV_%EC%83%89_%EA%B3%B5%EA%B0%84)

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np

image = cv2.imread('../data/Lena.png').astype(np.float32)/255
print('Shape:',image.shape)
print('Data type:',image.dtype)

#이미지를 그레이 스케일로 변환한다
gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)
print('Converted to grayscale')
print('Shape:',gray.shape)
print('Data type:',gray.dtype)
cv2.imshow('gray',gray)
cv2.waitKey()
cv2.destroyAllWindows()

#이미지를 HSV색 공간으로 변환한다
hsv = cv2.cvtColor(image,cv2.COLOR_BGR2HSV)
print('Converted to HSV')
print('Shape:',hsv.shape)
print('Data type:',hsv.dtype)
cv2.imshow('HSV',hsv)
cv2.waitKey()
cv2.destroyAllWindows()

#V채널에 값을 곱해 이미지의 밝기를 높이고 나서 이미지를 RGB색 공간으로 변환한다.
hsv[:,:,2]*=2
from_hsv=cv2.cvtColor(hsv,cv2.COLOR_HSV2BGR)
print('Converted back to BGR from HSV')
print('Shape:',from_hsv.shape)
print('Data type:',from_hsv.dtype)
cv2.imshow('from_hsv',from_hsv)
cv2.waitKey()
cv2.destroyAllWindows()
```
```
>>>
Shape: (512, 512, 3)
Data type: float32
Converted to grayscale
Shape: (512, 512)
Data type: float32
Converted to HSV
Shape: (512, 512, 3)
Data type: float32
Converted back to BGR from HSV
Shape: (512, 512, 3)
Data type: float32
```
![스크린샷, 2021-09-14 12-19-23](https://user-images.githubusercontent.com/69246778/133189467-317d3983-1809-46e5-803e-644b28875e35.png)
![스크린샷, 2021-09-14 12-19-28](https://user-images.githubusercontent.com/69246778/133189466-d7c268eb-28a7-4335-a8f8-e53e1c1a82ce.png)
![스크린샷, 2021-09-14 12-19-34](https://user-images.githubusercontent.com/69246778/133189463-e04adb7e-a5e1-4f59-a314-e86e74b5f0c6.png)


## 6. 감마 보정과 요소 단위의 수학
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np
image = cv2.imread('../data/Lena.png').astype(np.float32)/255

#지정된 지수값인 gamma를 사용해 요소당 지수를 적용한다
gamma = 0.5
corrected_image  = np.power(image,gamma)

cv2.imshow('image',image)
cv2.imshow('corrected_image',corrected_image)
cv2.waitKey()
cv2.destroyAllWindows()
```
![스크린샷, 2021-09-14 12-22-43](https://user-images.githubusercontent.com/69246778/133189787-b1aa08c6-86ee-48d8-9cc2-084ee9947472.png)

## 7. 평균/분산 이미지 정규화
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-


import cv2, numpy as np

image=cv2.imread('../data/Lena.png').astype(np.float32)/255

#각 이미지 픽셀에서 평균을 빼 제로 평균 행렬을 구함
image -=image.mean()

#위에서 구한 행렬에서 각 픽셀값을 표준편차로 나눠 단위 분산 행렬을 구함
image /=image.std()
```

## 8. 이미지 히스토그램 계산
```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import cv2, numpy as np
import matplotlib.pyplot as plt

grey = cv2.imread('../data/Lena.png',0)
cv2.imshow('original grey',grey)
cv2.waitKey()
cv2.destroyAllWindows()


#histogram함수로 계산
hist,bins = np.histogram(grey, 256, [0,255])

#히스토그램을 화면에 표시
plt.fill(hist)
plt.xlabel('pixel value')
plt.show()
```
![스크린샷, 2021-09-14 12-24-19](https://user-images.githubusercontent.com/69246778/133189969-6843b32b-706a-46c2-8a98-fac4e4369cdd.png)
![스크린샷, 2021-09-14 12-24-29](https://user-images.githubusercontent.com/69246778/133189974-74db17b6-81bc-4d69-a03d-7eefbfa3186b.png)

## 9. 이미지 [히스토그램의 평활화](https://opencv-python.readthedocs.io/en/latest/doc/20.imageHistogramEqualization/imageHistogramEqualization.html)
