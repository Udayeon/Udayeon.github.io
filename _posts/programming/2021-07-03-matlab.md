---
layout: post
title: Matlab Driving Scenario Designer ToolBox
description: >
  Matlab의 Driving Scenario Designer ToolBox를 이용한 주행환경 시뮬레이션
tags: [programming]
author: Udayeon
---
# (Matlab) Driving Scenario Designer ToolBox
* * *
<과제>
1. 차량이 특정한 Waypoints를 따라 주행하도록 하기
2. 차량에 센서를 설치하고 Sensor Data 추출하기
{:.message}

# 개요
Driving Scenario Designer ToolBox를 이용하면 도로, 차량, 장애물, 센서 등을 간편하게 구현할 수 있다.  
Waypoints를 설정해서 차량이 그 Waypoints를 따라 주행하도록 할 수도 있다.   

**Waypoints설정방법**
1. 차량에대고 우클릭> Add Forward Waypoints > 원하는 위치 클릭 > Enter
2. 왼쪽의 Actors 탭 > Trajectory > (x,y,z)항목 수정
{:.message}

위의 두 가지 방법이 있는데, 내가 하고 싶은건 이미 주어진 Waypoints Data를 Driving Scenario Designer ToolBox로 가져오는 것이다.

**Waypoints Data를 시나리오 환경으로 가져오기**
1. 시나리오에 도로, 차량, 센서, Waypoints를 아무렇게나 만든다.
2. 이때, 도로나 차량 스펙같은거 미리 설정해두면 편함.
3. 2차로 고속도로를 가정하고 Number of Lanes는 2로, Lane Width는 3.6으로, 차량 길이는 3.05m로 가정
4. 이렇게 구성된 주행 환경을  🔥**Save > Scenario File **🔥
5. 저장된 Scenario File을 Matlab에 불러옴
6. 불러온 file안에 **data Struct**가 있고, 여기서 필요한 부분을 수정할 것
7. 🔥**data > ActorSpecifications > Waypoints**🔥로 들어가서 Waypoints를 수정
8. 수정한 후 다른이름으로 저장
9. 다시 Driving Scenario Designer ToolBox로 돌아옴
10. 🔥**Open > Roads & Actors > 아까 저장한 Waypoints data**🔥
11. 그럼 외부의 WayPoints 데이터로 새로운 주행환경이 설정됨
{:.message}

같은 방식으로 도로설정(Road Centes 같은 것들)도 변경해서 가져올 수 있음.   
Waypoints가 한 차로의 중심에 오도록 하려고 다음과 같이 설정함
![Inkedroad_LI](https://user-images.githubusercontent.com/69246778/126020190-910887fe-2a9d-4a51-9723-198934f38c27.jpg)
```
Road Centers = Waypoints + [0, Width/2, 0]
```
   
도로와 Waypoints가 모두 설정되면 차량에 Sensor를 달아보자.
Toolstrip에서 원하는 센서를 선택하면 원하는 위치에 설치할 수 있음.   
   
**SensorData를 이용해 다양한 값들을 추출하기**
1. toolstrip의 **Export > MATLAB Function**
2. 그럼 다음과 같은 함수 형태로 Export됨
3. 이 함수 파일 안에 3개의 함수가 생성되어 있음
  - generateSensorData
  - createSensor
  - createDrivingScenario
4. 이 세 개의 함수를 이용해 각 Waypoint 마다의 값을 추출하는 스크립트 파일을 만들 거
5. generateSensorData와 createDrivingScenario를 하나의 함수파일에 넣고, CreateSensor는 따로 저장해둠.
6. 먼저 SensorData를 사용하기 위해 참조를 설정해주고, 시나리오 끝나는 시간과 데이터 추출 간격을 설정함
```
reference_data=generateSensorData;   %참조
Tfinal = 6.04;                       %시나리오 돌려보면 끝날 때까지 T=6.04s걸림
T_size=0:0.0302:Tfinal;              %내가 가진 Waypoints 데이티가 201개 였으므로 한 간격 = 6.04/200 = 0.0302
                                     %T_size = 1*201
```

7. for문 돌려서 201개의 waypoint 각각마다의 정보를 추출함.
```
for k=1:size(T_size,2)
  🚨유출금지 코드임🚨
end
```
**x방향속도, y방향속도, yaw, cruise angle, side-slip angle 추출함**






#####
[Driving Scenario](https://kr.mathworks.com/help//driving/ref/drivingscenario.html)
[Create Driving Scenario Programmatically](https://kr.mathworks.com/help/driving/ug/create-driving-scenario-programmatically.html?searchHighlight=driving%20scenario&s_tid=srchtitle)
